name: magiclink
description: Syncano Socket for generating magic links for users
runtime: nodejs_v8

classes:
  user:
    - name: email
      type: string
      filter_index: true

  magiclink:
    - name: email
      type: string
      filter_index: true

    - name: token
      type: string
      filter_index: true

    - name: validUntil
      type: datetime

endpoints:
  generate:
    private: true
    description: Endpoint used to login/create user account
    parameters:
      email:
        type: string
        description: "Email to login user"
        example: "jon.doe@doe.com"
    response:
      mimetype: text/plain
      examples:
        -
          exit_code: 200
          description: Success
          example: "Waiting for magiclink"
        -
          exit_code: 400
          description: Failed
          example: No email or status provided
  verify:
    description: "Endpoint used to verify user login"
    parameters:
      email:
        type: string
        description: "user email"
        example: "johndoe@foe.com"
      token: 
        type: string
        description: "magic link token"
        example: "4fdasf#$#()adsczx"
    response:
      mimetype: application/json
      examples:
        -
          exit_code: 200
          description: Success
          example: |
            userData {
              userKey,
              id,
              firstname,
              lastname,
              isVolunteer,
              email
            }
        -
          exit_code: 403
          description: Failed
          example: "Unauthorized"
